<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>坐标系测试</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background: #f0f0f0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    button {
      background: #2196F3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }

    button:hover {
      background: #1976D2;
    }

    button.success {
      background: #4CAF50;
    }

    button.warning {
      background: #ff9800;
    }

    #log {
      background: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
      font-size: 12px;
      margin: 10px 0;
    }

    #renderContainer {
      width: 100%;
      height: 500px;
      border: 1px solid #ddd;
      margin: 10px 0;
      position: relative;
    }

    .coordinate-info {
      background: #e3f2fd;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      border-left: 4px solid #2196F3;
    }

    .legend {
      display: flex;
      gap: 20px;
      margin: 10px 0;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 3px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>坐标系测试</h1>

    <div class="coordinate-info">
      <h3>坐标系说明</h3>
      <p><strong>红色轴 (X):</strong> 向右为正方向</p>
      <p><strong>绿色轴 (Y):</strong> 向上为正方向</p>
      <p><strong>蓝色轴 (Z):</strong> 向前为正方向</p>
      <p><strong>绿色立方体:</strong> 位于原点 (0,0,0) 的参考物体</p>
    </div>

    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="background: #ff0000;"></div>
        <span>X轴 (红色)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #00ff00;"></div>
        <span>Y轴 (绿色)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #0000ff;"></div>
        <span>Z轴 (蓝色)</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #00ff00; opacity: 0.3;"></div>
        <span>参考立方体</span>
      </div>
    </div>

    <div>
      <button onclick="initDemo()">初始化演示</button>
      <button onclick="testCamera()">测试相机</button>
      <button onclick="addTestObjects()">添加测试物体</button>
      <button onclick="clearLog()">清空日志</button>
    </div>

    <div id="renderContainer"></div>
    <div id="log"></div>
  </div>

  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';

    let scene, camera, renderer, controls;

    function log (message, type = 'info') {
      const logDiv = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const typeIcon = {
        'success': '✓',
        'error': '✗',
        'warning': '⚠',
        'info': 'ℹ'
      }[type] || 'ℹ';

      const logEntry = `[${timestamp}] ${typeIcon} ${message}\n`;
      logDiv.textContent += logEntry;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function initScene () {
      const container = document.getElementById('renderContainer');

      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x000000);

      camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
      camera.position.set(0, 20, 30);
      camera.lookAt(0, 0, 0);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(container.clientWidth, container.clientHeight);
      container.appendChild(renderer.domElement);

      controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;

      // 添加光照
      const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight.position.set(10, 10, 5);
      scene.add(directionalLight);

      // 添加坐标轴辅助器
      const axesHelper = new THREE.AxesHelper(20);
      scene.add(axesHelper);

      // 添加坐标轴标签
      const createAxisLabel = (text, position, color) => {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = 64;
        canvas.height = 64;
        context.fillStyle = color;
        context.font = '24px Arial';
        context.textAlign = 'center';
        context.fillText(text, 32, 32);

        const texture = new THREE.CanvasTexture(canvas);
        const material = new THREE.SpriteMaterial({ map: texture });
        const sprite = new THREE.Sprite(material);
        sprite.position.copy(position);
        sprite.scale.set(2, 2, 2);
        scene.add(sprite);
      };

      createAxisLabel('X', new THREE.Vector3(25, 0, 0), '#ff0000');
      createAxisLabel('Y', new THREE.Vector3(0, 25, 0), '#00ff00');
      createAxisLabel('Z', new THREE.Vector3(0, 0, 25), '#0000ff');

      // 添加参考立方体
      const geometry = new THREE.BoxGeometry(1, 1, 1);
      const material = new THREE.MeshBasicMaterial({
        color: 0x00ff00,
        wireframe: true,
        transparent: true,
        opacity: 0.3,
      });
      const cube = new THREE.Mesh(geometry, material);
      cube.position.set(0, 0, 0);
      cube.name = "referenceCube";
      scene.add(cube);

      animate();
      log('✓ 坐标系测试场景初始化完成', 'success');
      log('  相机位置: (0, 20, 30)', 'info');
      log('  坐标轴长度: 20 单位', 'info');
      log('  参考立方体: 1×1×1 单位', 'info');
    }

    function animate () {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }

    window.initDemo = function () {
      log('=== 初始化坐标系测试 ===', 'info');

      if (scene) {
        // 清除现有场景
        while (scene.children.length > 0) {
          scene.remove(scene.children[0]);
        }
      }

      initScene();
    };

    window.testCamera = function () {
      log('=== 测试相机控制 ===', 'info');

      if (!camera) {
        log('✗ 请先初始化场景', 'error');
        return;
      }

      log(`当前相机位置: (${camera.position.x.toFixed(2)}, ${camera.position.y.toFixed(2)}, ${camera.position.z.toFixed(2)})`, 'info');
      log(`当前相机朝向: (${camera.getWorldDirection(new THREE.Vector3()).x.toFixed(2)}, ${camera.getWorldDirection(new THREE.Vector3()).y.toFixed(2)}, ${camera.getWorldDirection(new THREE.Vector3()).z.toFixed(2)})`, 'info');

      // 测试不同视角
      const testPositions = [
        { pos: [0, 20, 30], name: '默认视角' },
        { pos: [30, 0, 0], name: 'X轴正方向' },
        { pos: [-30, 0, 0], name: 'X轴负方向' },
        { pos: [0, 30, 0], name: 'Y轴正方向' },
        { pos: [0, 0, 30], name: 'Z轴正方向' },
        { pos: [20, 20, 20], name: '等距视角' }
      ];

      let currentIndex = 0;
      const testInterval = setInterval(() => {
        if (currentIndex >= testPositions.length) {
          clearInterval(testInterval);
          // 恢复到默认位置
          camera.position.set(0, 20, 30);
          camera.lookAt(0, 0, 0);
          controls.target.set(0, 0, 0);
          controls.update();
          log('✓ 相机测试完成，已恢复到默认位置', 'success');
          return;
        }

        const test = testPositions[currentIndex];
        camera.position.set(...test.pos);
        camera.lookAt(0, 0, 0);
        controls.target.set(0, 0, 0);
        controls.update();

        log(`切换到 ${test.name}: (${test.pos.join(', ')})`, 'info');
        currentIndex++;
      }, 2000);
    };

    window.addTestObjects = function () {
      log('=== 添加测试物体 ===', 'info');

      if (!scene) {
        log('✗ 请先初始化场景', 'error');
        return;
      }

      // 在X轴正方向添加红色球体
      const sphereGeometry = new THREE.SphereGeometry(2, 16, 16);
      const sphereMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });
      const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
      sphere.position.set(10, 0, 0);
      sphere.name = "xAxisSphere";
      scene.add(sphere);

      // 在Y轴正方向添加绿色球体
      const sphere2 = new THREE.Mesh(sphereGeometry, sphereMaterial.clone());
      sphere2.material.color.setHex(0x00ff00);
      sphere2.position.set(0, 10, 0);
      sphere2.name = "yAxisSphere";
      scene.add(sphere2);

      // 在Z轴正方向添加蓝色球体
      const sphere3 = new THREE.Mesh(sphereGeometry, sphereMaterial.clone());
      sphere3.material.color.setHex(0x0000ff);
      sphere3.position.set(0, 0, 10);
      sphere3.name = "zAxisSphere";
      scene.add(sphere3);

      log('✓ 添加了三个测试球体:', 'success');
      log('  红色球体: X轴正方向 (10, 0, 0)', 'info');
      log('  绿色球体: Y轴正方向 (0, 10, 0)', 'info');
      log('  蓝色球体: Z轴正方向 (0, 0, 10)', 'info');
    };

    window.clearLog = function () {
      document.getElementById('log').textContent = '';
    };

    // 页面加载时初始化
    window.addEventListener('load', () => {
      log('坐标系测试页面加载完成', 'info');
      log('点击"初始化演示"开始测试', 'info');
    });
  </script>
</body>

</html>